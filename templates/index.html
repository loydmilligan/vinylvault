{% extends "base.html" %}

{% block title %}Collection - VinylVault{% endblock %}

{% block head %}
<!-- Additional styles for collection page are now in style.css -->
{% endblock %}

{% block content %}
<div class="collection-header">
    <div>
        <h1 class="collection-title">Your Collection</h1>
        {% if pagination.total %}
        <div class="collection-stats">
            {{ pagination.total }} album{{ 's' if pagination.total != 1 else '' }}
            {% if search_query %} matching "{{ search_query }}"{% endif %}
        </div>
        {% endif %}
    </div>
    
    <div class="sort-controls">
        <select id="sortBy" onchange="VinylVault.updateSort()">
            <option value="date_added" {% if sort_by == 'date_added' %}selected{% endif %}>Recently Added</option>
            <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title</option>
            <option value="artist" {% if sort_by == 'artist' %}selected{% endif %}>Artist</option>
            <option value="year" {% if sort_by == 'year' %}selected{% endif %}>Year</option>
            <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>Rating</option>
        </select>
        
        <select id="sortOrder" onchange="VinylVault.updateSort()">
            <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>Descending</option>
            <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>Ascending</option>
        </select>
    </div>
</div>

{% if albums %}
<div class="album-grid">
    {% for album in albums %}
    <div class="album-card" data-href="{{ url_for('album_detail', album_id=album.id) }}">
        <div class="album-cover">
            {% if album.cover_url %}
                <img data-src="{{ get_thumbnail_url(album.cover_url) }}" 
                     data-original-src="{{ album.cover_url }}"
                     data-size-type="thumbnails"
                     alt="{{ album.title }}" 
                     class="lazy-load"
                     loading="lazy">
            {% else %}
                <img src="{{ get_placeholder_url('thumbnails') }}" 
                     alt="{{ album.title }}"
                     class="placeholder">
            {% endif %}
        </div>
        
        <div class="album-info">
            <div class="album-title">{{ album.title }}</div>
            <div class="album-artist">{{ album.artist }}</div>
            
            <div class="album-meta">
                {% if album.year %}
                    <span class="album-year">{{ album.year }}</span>
                {% endif %}
                {% if album.rating %}
                    <span class="album-rating">★ {{ album.rating }}</span>
                {% endif %}
            </div>
            
            {% if album.genres %}
            <div class="album-genres">
                {% for genre in album.genres[:2] %}
                    <span class="genre-tag">{{ genre }}</span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

{% if pagination.pages > 1 %}
<div class="pagination">
    {% if pagination.has_prev %}
        <a href="{{ url_for('index', page=pagination.prev_num, sort=sort_by, order=sort_order, q=search_query) }}">‹ Prev</a>
    {% else %}
        <span class="disabled">‹ Prev</span>
    {% endif %}
    
    {% for page_num in range(1, pagination.pages + 1) %}
        {% if page_num == pagination.page %}
            <span class="current">{{ page_num }}</span>
        {% elif page_num <= 3 or page_num > pagination.pages - 3 or (page_num >= pagination.page - 1 and page_num <= pagination.page + 1) %}
            <a href="{{ url_for('index', page=page_num, sort=sort_by, order=sort_order, q=search_query) }}">{{ page_num }}</a>
        {% elif page_num == 4 or page_num == pagination.pages - 3 %}
            <span>...</span>
        {% endif %}
    {% endfor %}
    
    {% if pagination.has_next %}
        <a href="{{ url_for('index', page=pagination.next_num, sort=sort_by, order=sort_order, q=search_query) }}">Next ›</a>
    {% else %}
        <span class="disabled">Next ›</span>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="empty-state">
    {% if search_query %}
        <h2>No albums found</h2>
        <p>No albums match your search for "{{ search_query }}".</p>
        <a href="{{ url_for('index') }}" class="btn">View All Albums</a>
    {% else %}
        <h2>No albums in your collection</h2>
        <p>Your collection is empty. Sync with Discogs to import your vinyl records.</p>
        <a href="{{ url_for('sync') }}" class="btn">Sync Collection</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<!-- Touch-optimized functionality is now handled by app.js -->
<script>
// Set current page for pagination navigation
if (window.VinylVault) {
    VinylVault.currentPage = {{ pagination.page if pagination else 1 }};
}
</script>
{% endblock %}